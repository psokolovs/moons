<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moon Life Journey</title>
  <!-- Bootstrap CSS for responsiveness -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    /* Base space theme */
    body {
      background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      overflow-x: hidden;
    }
    /* Container for the initial form */
    #formContainer {
      padding-top: 50px;
      text-align: center;
    }
    /* Animation container (full viewport) */
    #animationContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      display: none;
      z-index: 10;
    }
    .animation-section {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    /* Fly-through animation: a starry background that scales to simulate movement */
    #flyThrough {
      background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/stars.png') center/cover no-repeat;
      animation: flyThroughAnim 3s forwards;
    }
    @keyframes flyThroughAnim {
      0% { transform: scale(1) translateY(0); opacity: 1; }
      100% { transform: scale(1.5) translateY(-50px); opacity: 0.5; }
    }
    /* Earth and Moon view styling */
    #earthMoonView {
      background: radial-gradient(ellipse at center, #09203f 0%, #537895 100%);
      opacity: 0;
      animation: fadeIn 1s forwards;
      display: none;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    /* Earth styling (a blue circle) */
    #earth {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, #1e90ff, #00008b);
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
    }
    /* Moon styling */
    #moonCycle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/moon.png') center/cover no-repeat;
      position: absolute;
      top: 20%;
      right: 10%;
    }
    /* Moon cycle spin animation (one full rotation over 3 seconds) */
    .spin {
      animation: spinCycle 3s linear;
    }
    @keyframes spinCycle {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    /* Count Animation Section (appears after the moon cycle) */
    #countAnimation {
      flex-direction: column;
      display: none;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      justify-content: flex-start;
      padding-top: 100px;
    }
    .number-animation {
      font-size: 2em;
      margin-bottom: 20px;
    }
    /* Container for moon icons (progress indicators) */
    #progressIcons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .moon-icon {
      font-size: 1.5em;
    }
    /* Share button styling */
    #shareBtn {
      margin-top: 30px;
      display: none;
    }
    /* Enhance date picker for mobile (larger font & padding) */
    input[type="date"] {
      font-size: 1.2em;
      padding: 10px;
    }
  </style>
</head>
<body>
  <!-- Input Form -->
  <div id="formContainer" class="container">
    <h1>Moon Life Journey</h1>
    <form id="birthForm" class="my-4">
      <label for="birthdate">Enter your Birth Date:</label>
      <input type="date" id="birthdate" class="form-control mx-auto" style="max-width: 300px;" required />
      <button type="submit" class="btn btn-primary mt-3">Launch</button>
    </form>
  </div>
  
  <!-- Animation Container (overlays entire screen) -->
  <div id="animationContainer">
    <!-- Fly-through Section -->
    <div id="flyThrough" class="animation-section">
      <h2>Flying through space...</h2>
    </div>
    <!-- Earth and Moon View -->
    <div id="earthMoonView" class="animation-section">
      <div id="earth"></div>
      <div id="moonCycle"></div>
    </div>
    <!-- Count Animation Section -->
    <div id="countAnimation" class="animation-section" style="flex-direction: column;">
      <div class="number-animation" id="moonCount"></div>
      <div id="progressIcons"></div>
    </div>
  </div>
  
  <!-- Share Button -->
  <div class="text-center">
    <button id="shareBtn" class="btn btn-success">Share Your Lunar Journey</button>
  </div>
  
  <script>
    // Set the max attribute on the date picker to today.
    document.getElementById('birthdate').max = new Date().toISOString().split("T")[0];
    
    // Average lunar month (synodic month) in days.
    const lunarMonth = 29.53059;
    let fullMoonsLived, nextMilestone;
    
    document.getElementById('birthForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const birthDateValue = document.getElementById('birthdate').value;
      if (!birthDateValue) return;
      const birthDate = new Date(birthDateValue);
      const currentDate = new Date();
      const daysLived = (currentDate - birthDate) / (1000 * 60 * 60 * 24);
      const moonsLived = daysLived / lunarMonth;
      fullMoonsLived = Math.floor(moonsLived);
      
      // Determine milestone:
      // If fewer than 10 moons, milestone = 10; otherwise, next multiple of 100.
      nextMilestone = fullMoonsLived < 10 ? 10 : Math.ceil(fullMoonsLived / 100) * 100;
      
      // Hide the form and display the animation container.
      document.getElementById('formContainer').style.display = 'none';
      document.getElementById('animationContainer').style.display = 'block';
      
      // Start the fly-through animation (3 seconds).
      setTimeout(showEarthMoonView, 3000);
    });
    
    function showEarthMoonView() {
      // Hide fly-through section.
      document.getElementById('flyThrough').style.display = 'none';
      // Show Earth & Moon view.
      const earthMoonView = document.getElementById('earthMoonView');
      earthMoonView.style.display = 'flex';
      
      // Trigger the moon cycle animation (add spin class for 3 seconds).
      const moonCycle = document.getElementById('moonCycle');
      moonCycle.classList.add('spin');
      
      // After 3 seconds, proceed to the count animation.
      setTimeout(() => {
        moonCycle.classList.remove('spin'); // stop the spin.
        earthMoonView.style.display = 'none';
        startCountAnimation();
      }, 3000);
    }
    
    function startCountAnimation() {
      const countSection = document.getElementById('countAnimation');
      countSection.style.display = 'flex';
      
      // Duration for counting (4 seconds).
      const duration = 4000;
      const startValue = 1;
      const endValue = fullMoonsLived;
      const startTime = Date.now();
      
      // Calculate thresholds for adding moon icons (every 10% of the milestone).
      const thresholdIncrement = nextMilestone / 10;
      let iconsAdded = 0;
      
      function updateCount() {
        const elapsed = Date.now() - startTime;
        let progress = elapsed / duration;
        if (progress > 1) progress = 1;
        const currentCount = Math.floor(startValue + (endValue - startValue) * progress);
        document.getElementById('moonCount').innerText = currentCount + " full moons lived so far";
        
        // Add a moon icon each time a new 10% threshold is reached.
        const expectedIcons = Math.floor(currentCount / thresholdIncrement);
        if (expectedIcons > iconsAdded) {
          const progressIcons = document.getElementById('progressIcons');
          for (let i = iconsAdded; i < expectedIcons; i++) {
            const icon = document.createElement('span');
            icon.className = 'moon-icon';
            icon.innerText = 'ðŸŒ•';
            progressIcons.appendChild(icon);
          }
          iconsAdded = expectedIcons;
        }
        
        if (progress < 1) {
          requestAnimationFrame(updateCount);
        } else {
          // When counting is complete, show the share button.
          document.getElementById('shareBtn').style.display = 'inline-block';
        }
      }
      
      requestAnimationFrame(updateCount);
    }
    
    // Share button functionality using the Web Share API (with clipboard fallback).
    document.getElementById("shareBtn").addEventListener("click", function() {
      const shareData = {
        title: "My Lunar Journey",
        text: "I have lived " + document.getElementById("moonCount").innerText + ". Check out your own lunar journey!",
        url: window.location.href
      };

      if (navigator.share) {
        navigator.share(shareData).then(() => {
          console.log("Shared successfully");
        }).catch((error) => {
          console.error("Error sharing", error);
        });
      } else {
        copyToClipboard(window.location.href);
        alert("Link copied to clipboard!");
      }
    });

    function copyToClipboard(text) {
      const tempInput = document.createElement("input");
      tempInput.style.position = "absolute";
      tempInput.style.left = "-1000px";
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand("copy");
      document.body.removeChild(tempInput);
    }
  </script>
</body>
</html>
