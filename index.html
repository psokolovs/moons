<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moon Life Journey - NES Edition</title>
  <!-- Import a retro, pixelated font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* Reset and basic styling for a retro NES look */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #000;
      color: #0f0; /* classic green-on-black look */
      font-family: 'Press Start 2P', cursive;
      overflow: hidden;
    }
    /* All "screens" will fill the viewport */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
    }
    .active { display: flex; }
    
    /* Title Screen (Start Screen) */
    #titleScreen {
      background: #000;
    }
    #titleScreen h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }
    .nes-button {
      background: #222;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s;
    }
    .nes-button:hover {
      background: #0f0;
      color: #000;
    }
    
    /* Form Screen */
    #formScreen {
      background: #000;
      padding: 20px;
    }
    #formScreen label {
      margin-bottom: 10px;
      display: block;
    }
    #formScreen input[type="date"] {
      font-family: 'Press Start 2P', cursive;
      font-size: 0.8em;
      background: #000;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 10px;
      width: 80%;
      max-width: 300px;
      margin-bottom: 20px;
    }
    
    /* Animation Screen: Simulate a retro space fly-through */
    #animationScreen {
      background: #000;
      position: relative;
      overflow: hidden;
    }
    /* A pixelated starry background (replace the URL with your own pixel art if desired) */
    .stars {
      position: absolute;
      width: 200%;
      height: 200%;
      background: url('https://i.imgur.com/ls6hO9F.png') repeat;
      image-rendering: pixelated;
      animation: scrollStars 10s linear infinite;
    }
    @keyframes scrollStars {
      from { transform: translateY(0); }
      to { transform: translateY(-50%); }
    }
    
    /* Earth & Moon Screen */
    #earthMoonScreen {
      background: #000;
      display: none;
      position: relative;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    /* Simulated pixel Earth */
    #earth {
      width: 100px;
      height: 100px;
      border: 4px solid #0f0;
      border-radius: 50%;
      background: #001; /* dark blue */
      margin-top: 20px;
      image-rendering: pixelated;
    }
    /* Moon image for the cycle (replace with your own pixel art if desired) */
    #moonCycle {
      width: 80px;
      height: 80px;
      background: url('https://i.imgur.com/AQvLRbg.png') center/cover no-repeat;
      image-rendering: pixelated;
    }
    @keyframes rotateMoon {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .rotate { animation: rotateMoon 3s steps(12) linear; }
    
    /* Count Screen: Animated score with retro progress icons */
    #countScreen {
      background: #000;
      display: none;
      flex-direction: column;
    }
    #moonCount {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #progressIcons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 20px;
    }
    .moon-icon { font-size: 1em; }
    
    /* Share Button Styling */
    #shareBtn {
      margin-top: 20px;
      background: #222;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 0.8em;
      transition: background 0.2s;
    }
    #shareBtn:hover {
      background: #0f0;
      color: #000;
    }
  </style>
</head>
<body>
  <!-- Title Screen -->
  <div id="titleScreen" class="screen active">
    <h1>MOON LIFE JOURNEY</h1>
    <button id="startBtn" class="nes-button">PRESS START</button>
  </div>
  
  <!-- Form Screen -->
  <div id="formScreen" class="screen">
    <h2>ENTER YOUR BIRTHDATE</h2>
    <form id="birthForm">
      <label for="birthdate">Birth Date:</label>
      <input type="date" id="birthdate" required />
      <br>
      <button type="submit" class="nes-button">CALCULATE</button>
    </form>
  </div>
  
  <!-- Animation Screen: Retro space fly-through -->
  <div id="animationScreen" class="screen">
    <div class="stars"></div>
    <h2 style="z-index: 2;">FLYING THROUGH SPACE...</h2>
  </div>
  
  <!-- Earth & Moon Screen: Show full view of Earth and the Moon -->
  <div id="earthMoonScreen" class="screen">
    <div id="moonCycle"></div>
    <div id="earth"></div>
  </div>
  
  <!-- Count Screen: Display the number of moons and progress icons -->
  <div id="countScreen" class="screen">
    <div id="moonCount"></div>
    <div id="progressIcons"></div>
    <button id="shareBtn" style="display: none;">SHARE YOUR JOURNEY</button>
  </div>
  
  <script>
    // Set maximum date for birthdate input to today
    document.getElementById('birthdate').max = new Date().toISOString().split("T")[0];
    
    // Average lunar month (synodic month) in days
    const lunarMonth = 29.53059;
    let fullMoonsLived = 0;
    let nextMilestone = 0;
    
    // Screen elements
    const titleScreen = document.getElementById('titleScreen');
    const formScreen = document.getElementById('formScreen');
    const animationScreen = document.getElementById('animationScreen');
    const earthMoonScreen = document.getElementById('earthMoonScreen');
    const countScreen = document.getElementById('countScreen');
    
    // Title Screen: Press Start
    document.getElementById('startBtn').addEventListener('click', function() {
      titleScreen.classList.remove('active');
      formScreen.classList.add('active');
    });
    
    // Form submission: calculate lunar cycles
    document.getElementById('birthForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const birthDateValue = document.getElementById('birthdate').value;
      if (!birthDateValue) return;
      const birthDate = new Date(birthDateValue);
      const currentDate = new Date();
      const daysLived = (currentDate - birthDate) / (1000 * 60 * 60 * 24);
      const moonsLived = daysLived / lunarMonth;
      fullMoonsLived = Math.floor(moonsLived);
      
      // Milestone: if fewer than 10 moons, milestone = 10; otherwise, next multiple of 100.
      nextMilestone = fullMoonsLived < 10 ? 10 : Math.ceil(fullMoonsLived / 100) * 100;
      
      // Transition to the animation screen
      formScreen.classList.remove('active');
      animationScreen.classList.add('active');
      
      // After a 3-second "fly-through", transition to Earth & Moon screen
      setTimeout(() => {
        animationScreen.classList.remove('active');
        earthMoonScreen.classList.add('active');
        
        // Start the moon cycle animation (a full rotation over 3 seconds with retro “steppy” rotation)
        const moonCycle = document.getElementById('moonCycle');
        moonCycle.classList.add('rotate');
        setTimeout(() => {
          // End moon cycle and move to the counting screen
          moonCycle.classList.remove('rotate');
          earthMoonScreen.classList.remove('active');
          countScreen.classList.add('active');
          startCountAnimation();
        }, 3000);
      }, 3000);
    });
    
    // Count animation: speed up the count to the current lunar cycle number,
    // and add a moon icon for each 10% of the milestone reached.
    function startCountAnimation() {
      const moonCountElem = document.getElementById('moonCount');
      const progressIconsElem = document.getElementById('progressIcons');
      let currentCount = 0;
      const duration = 4000; // count animation duration (in milliseconds)
      const startTime = Date.now();
      const thresholdIncrement = nextMilestone / 10;
      let iconsAdded = 0;
      
      function updateCount() {
        const elapsed = Date.now() - startTime;
        let progress = elapsed / duration;
        if (progress > 1) progress = 1;
        currentCount = Math.floor(progress * fullMoonsLived);
        moonCountElem.innerText = currentCount + " FULL MOONS LIVED";
        
        // Every time a new 10% threshold is reached, add a retro moon icon.
        let expectedIcons = Math.floor(currentCount / thresholdIncrement);
        if (expectedIcons > iconsAdded) {
          for (let i = iconsAdded; i < expectedIcons; i++) {
            let icon = document.createElement('span');
            icon.className = 'moon-icon';
            icon.innerText = '🌕';
            progressIconsElem.appendChild(icon);
          }
          iconsAdded = expectedIcons;
        }
        
        if (progress < 1) {
          requestAnimationFrame(updateCount);
        } else {
          // Final update and display the share button
          moonCountElem.innerText = fullMoonsLived + " FULL MOONS LIVED";
          document.getElementById('shareBtn').style.display = 'inline-block';
        }
      }
      requestAnimationFrame(updateCount);
    }
    
    // Share button: use Web Share API or copy URL to clipboard as fallback
    document.getElementById('shareBtn').addEventListener('click', function() {
      const shareData = {
        title: "My Moon Life Journey",
        text: "I've lived " + fullMoonsLived + " full moons! Check out your own retro lunar journey!",
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData)
          .then(() => console.log("Shared successfully"))
          .catch((error) => console.error("Error sharing", error));
      } else {
        copyToClipboard(window.location.href);
        alert("Link copied to clipboard!");
      }
    });
    
    function copyToClipboard(text) {
      const tempInput = document.createElement("input");
      tempInput.style.position = "absolute";
      tempInput.style.left = "-1000px";
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand("copy");
      document.body.removeChild(tempInput);
    }
  </script>
</body>
</html>
