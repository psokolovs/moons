<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Moon Life Calculator</title>
  <!-- Bootstrap CSS for mobile friendly styling -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Simple animation styles for the progress bar and number display */
    .progress-bar {
      transition: width 2s ease;
    }
    .number-animation {
      font-size: 2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4">Moon Life Calculator</h1>
    <!-- Mobile-friendly form for birthdate input -->
    <form id="birthForm">
      <div class="mb-3">
        <label for="birthdate" class="form-label">Enter your Birth Date:</label>
        <input type="date" class="form-control" id="birthdate" required>
      </div>
      <button type="submit" class="btn btn-primary">Calculate</button>
    </form>
    
    <!-- Results Section (hidden until calculation is done) -->
    <div id="result" class="mt-5" style="display: none;">
      <h2>Your Lunar Journey</h2>
      <!-- Animated number of full moons lived -->
      <p class="number-animation" id="moonCount"></p>
      <!-- Progress bar showing how far along you are toward the next milestone -->
      <div class="progress my-3" style="height: 30px;">
        <div id="moonProgress" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p id="milestoneMessage"></p>
      <!-- Table with milestone lunar cycle dates -->
      <div id="milestoneDates" class="mt-3"></div>
    </div>
  </div>

  <script>
    // Average lunar month length in days (synodic month)
    const lunarMonth = 29.53059;

    document.getElementById('birthForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const birthDateValue = document.getElementById('birthdate').value;
      if (!birthDateValue) return;
      
      const birthDate = new Date(birthDateValue);
      const currentDate = new Date();
      
      // Calculate the number of days lived
      const daysLived = (currentDate - birthDate) / (1000 * 60 * 60 * 24);
      // Calculate the number of full moons (lunations) lived so far
      const moonsLived = daysLived / lunarMonth;
      const fullMoonsLived = Math.floor(moonsLived);
      
      // Determine the next milestone based on current count
      let nextMilestone;
      if (fullMoonsLived < 10) {
        nextMilestone = 10;
      } else if (fullMoonsLived < 100) {
        nextMilestone = 100;
      } else if (fullMoonsLived < 250) {
        nextMilestone = 250;
      } else if (fullMoonsLived < 750) {
        nextMilestone = 750;
      } else {
        // For higher numbers, you might choose the next milestone as the next multiple of 500
        nextMilestone = Math.ceil(fullMoonsLived / 500) * 500;
      }
      
      const moonsRemaining = nextMilestone - fullMoonsLived;
      
      // Calculate the start and end dates of the milestone lunar cycle.
      // The "nth" lunar cycle starts on birthdate + (n-1)*lunarMonth and ends on birthdate + n*lunarMonth.
      const milestoneStart = new Date(birthDate.getTime() + (nextMilestone - 1) * lunarMonth * 24 * 60 * 60 * 1000);
      const milestoneEnd = new Date(birthDate.getTime() + nextMilestone * lunarMonth * 24 * 60 * 60 * 1000);
      
      // Animate the moon count display
      animateNumber("moonCount", fullMoonsLived, 2000);
      
      // Animate the progress bar (using the milestone as the maximum)
      const progressPercent = (fullMoonsLived / nextMilestone) * 100;
      document.getElementById("moonProgress").style.width = progressPercent + "%";
      document.getElementById("moonProgress").setAttribute("aria-valuenow", fullMoonsLived);
      
      // Set milestone message and display the dates of that lunar cycle in a table
      document.getElementById("milestoneMessage").innerHTML = 
        "Your next milestone is " + nextMilestone + " full moons. " +
        "You have " + moonsRemaining + " full moons left until then.";
      
      document.getElementById("milestoneDates").innerHTML = 
        "<table class='table table-bordered'>" +
          "<thead><tr><th>Cycle</th><th>Start Date</th><th>End Date</th></tr></thead>" +
          "<tbody>" +
            "<tr>" +
              "<td>" + nextMilestone + "th</td>" +
              "<td>" + milestoneStart.toDateString() + "</td>" +
              "<td>" + milestoneEnd.toDateString() + "</td>" +
            "</tr>" +
          "</tbody>" +
        "</table>";
      
      // Reveal the results section
      document.getElementById("result").style.display = "block";
    });

    // A simple function to animate a number counting up to the target value
    function animateNumber(elementId, targetNumber, duration) {
      let current = 0;
      const stepTime = 50; // milliseconds
      const steps = duration / stepTime;
      const increment = targetNumber / steps;
      const element = document.getElementById(elementId);
      
      const interval = setInterval(function() {
        current += increment;
        if (current >= targetNumber) {
          current = targetNumber;
          clearInterval(interval);
        }
        element.innerText = Math.floor(current) + " full moons lived so far";
      }, stepTime);
    }
  </script>
</body>
</html>
