<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hyper-Realistic Moon Life Journey</title>
  <style>
    /* Reset and full-screen basics */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    /* Input Screen (centered form) */
    #inputScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 10;
    }
    #inputScreen h1 {
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    #birthForm {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    #birthForm input[type="date"] {
      width: 320px; /* wide enough to show a 4-digit year */
      max-width: 90%;
      font-size: 1.2em;
      padding: 10px;
      border: 2px solid #fff;
      background: #111;
      color: #fff;
    }
    #birthForm button {
      font-size: 1.2em;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    #birthForm button:hover {
      background: #ccc;
    }
    /* Canvas covers full screen */
    #sceneCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    /* Overlay for counter and share button */
    #overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 20;
      pointer-events: none; /* allow canvas events underneath if needed */
    }
    #counterOverlay {
      font-size: 2em;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 1s;
    }
    #progressIcons {
      margin-bottom: 10px;
    }
    .moon-icon {
      font-size: 1.8em;
      margin: 0 3px;
    }
    #shareButton {
      font-size: 1.2em;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      display: none;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Input Screen -->
  <div id="inputScreen">
    <h1>Moon Life Journey</h1>
    <form id="birthForm">
      <input type="date" id="birthdate" required />
      <button type="submit">Calculate My Moons</button>
    </form>
  </div>

  <!-- The Canvas for the animated scene -->
  <canvas id="sceneCanvas"></canvas>

  <!-- HTML Overlay for counter and progress icons -->
  <div id="overlay">
    <div id="counterOverlay"></div>
    <div id="progressIcons"></div>
    <button id="shareButton">Share Your Journey</button>
  </div>

  <script>
    /*********** GLOBAL VARIABLES ***********/
    const lunarMonth = 29.53059; // days per lunar cycle
    let fullMoonsLived = 0;
    let milestone = 0; // next milestone (10 if <10, otherwise next multiple of 100)
    
    // Animation phase durations (in milliseconds)
    const moonRotationDuration = 3000; // 3 seconds for moon rotation
    const counterAnimationDuration = 4000; // 4 seconds for counter overlay
    // Total animation duration for scene: moon rotation + counter animation
    // (starfield and scene remain animated continuously)
    
    /*********** SETUP ELEMENTS ***********/
    const inputScreen = document.getElementById('inputScreen');
    const birthForm = document.getElementById('birthForm');
    const birthdateInput = document.getElementById('birthdate');
    const sceneCanvas = document.getElementById('sceneCanvas');
    const counterOverlay = document.getElementById('counterOverlay');
    const progressIcons = document.getElementById('progressIcons');
    const shareButton = document.getElementById('shareButton');
    
    // Set maximum date for date input to today
    birthdateInput.max = new Date().toISOString().split("T")[0];
    
    // Setup canvas dimensions
    const ctx = sceneCanvas.getContext('2d');
    function resizeCanvas() {
      sceneCanvas.width = window.innerWidth;
      sceneCanvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    /*********** STARFIELD SETUP ***********/
    // Create an array of stars with random positions and sizes
    const stars = [];
    const numStars = 500;
    for (let i = 0; i < numStars; i++) {
      stars.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        radius: Math.random() * 1.5,
        alpha: Math.random() * 0.8 + 0.2
      });
    }
    
    /*********** SCENE OBJECTS ***********/
    // Earth properties (drawn as a circle with a radial gradient)
    const earth = {
      x: window.innerWidth * 0.2,
      y: window.innerHeight * 0.8,
      radius: Math.min(window.innerWidth, window.innerHeight) * 0.15
    };
    // Moon properties (positioned in upper right)
    const moon = {
      x: window.innerWidth * 0.8,
      y: window.innerHeight * 0.3,
      radius: Math.min(window.innerWidth, window.innerHeight) * 0.1
    };
    
    /*********** ANIMATION LOOP ***********/
    let animationStartTime = null;
    function drawScene(timestamp) {
      if (!animationStartTime) animationStartTime = timestamp;
      const elapsed = timestamp - animationStartTime;
      
      // Clear canvas
      ctx.clearRect(0, 0, sceneCanvas.width, sceneCanvas.height);
      
      // Draw starfield background
      drawStars();
      
      // Draw Earth
      drawEarth();
      
      // Draw Moon with rotation in the first phase
      if (elapsed < moonRotationDuration) {
        const angle = (elapsed / moonRotationDuration) * 2 * Math.PI; // full rotation (radians)
        drawMoon(angle);
      } else {
        drawMoon(0); // no rotation after phase
      }
      
      // Continue the animation loop
      requestAnimationFrame(drawScene);
    }
    
    function drawStars() {
      // For each star, draw a circle
      for (let star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, 2 * Math.PI);
        ctx.fillStyle = `rgba(255,255,255,${star.alpha})`;
        ctx.fill();
      }
    }
    
    function drawEarth() {
      const grad = ctx.createRadialGradient(
        earth.x - earth.radius * 0.3, earth.y - earth.radius * 0.3, earth.radius * 0.2,
        earth.x, earth.y, earth.radius
      );
      // Simulate deep blue with hints of light
      grad.addColorStop(0, '#0a2e5a');
      grad.addColorStop(1, '#001a33');
      ctx.beginPath();
      ctx.arc(earth.x, earth.y, earth.radius, 0, 2 * Math.PI);
      ctx.fillStyle = grad;
      ctx.fill();
      // Optional: add a subtle glow
      ctx.shadowColor = '#0a2e5a';
      ctx.shadowBlur = 20;
      ctx.fill();
      ctx.shadowBlur = 0;
    }
    
    function drawMoon(rotationAngle) {
      // Save context state
      ctx.save();
      // Translate to moon center
      ctx.translate(moon.x, moon.y);
      // Rotate the context by the desired angle
      ctx.rotate(rotationAngle);
      // Create a radial gradient for a realistic moon look
      const grad = ctx.createRadialGradient(
        -moon.radius * 0.3, -moon.radius * 0.3, moon.radius * 0.1,
        0, 0, moon.radius
      );
      grad.addColorStop(0, '#e0e0e0');
      grad.addColorStop(1, '#777777');
      ctx.beginPath();
      ctx.arc(0, 0, moon.radius, 0, 2 * Math.PI);
      ctx.fillStyle = grad;
      ctx.fill();
      // Optionally, simulate subtle craters with small darker circles
      ctx.fillStyle = 'rgba(0,0,0,0.2)';
      for (let i = 0; i < 5; i++) {
        const cx = (Math.random() - 0.5) * moon.radius * 0.8;
        const cy = (Math.random() - 0.5) * moon.radius * 0.8;
        const cr = Math.random() * moon.radius * 0.15;
        ctx.beginPath();
        ctx.arc(cx, cy, cr, 0, 2 * Math.PI);
        ctx.fill();
      }
      // Restore context state
      ctx.restore();
    }
    
    /*********** OVERLAY / COUNTER ANIMATION ***********/
    function animateCounter(targetValue, duration) {
      let startTime = null;
      const thresholdIncrement = targetValue < 10 ? 10/10 : (milestone / 10);
      let iconsAdded = 0;
      
      function stepOverlay(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = timestamp - startTime;
        const currentCount = Math.floor((progress / duration) * targetValue);
        counterOverlay.innerText = currentCount + " FULL MOONS LIVED";
        // Add a moon icon for every threshold crossed
        const expectedIcons = Math.floor(currentCount / thresholdIncrement);
        if (expectedIcons > iconsAdded) {
          for (let i = iconsAdded; i < expectedIcons; i++) {
            const span = document.createElement('span');
            span.className = 'moon-icon';
            span.innerText = 'ðŸŒ•';
            progressIcons.appendChild(span);
          }
          iconsAdded = expectedIcons;
        }
        if (progress < duration) {
          requestAnimationFrame(stepOverlay);
        } else {
          counterOverlay.innerText = targetValue + " FULL MOONS LIVED";
          shareButton.style.display = 'inline-block';
        }
      }
      // Fade in the overlay text
      counterOverlay.style.opacity = 1;
      requestAnimationFrame(stepOverlay);
    }
    
    /*********** FORM HANDLING & TRANSITIONS ***********/
    birthForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const birthDateStr = birthdateInput.value;
      if (!birthDateStr) return;
      const birthDate = new Date(birthDateStr);
      const currentDate = new Date();
      const daysLived = (currentDate - birthDate) / (1000 * 60 * 60 * 24);
      fullMoonsLived = Math.floor(daysLived / lunarMonth);
      
      // Determine milestone: if <10, use 10; otherwise, next multiple of 100.
      milestone = fullMoonsLived < 10 ? 10 : Math.ceil(fullMoonsLived / 100) * 100;
      
      // Hide the input screen and show the canvas and overlay
      inputScreen.style.display = 'none';
      sceneCanvas.style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
      
      // Start the canvas animation loop
      animationStartTime = null;
      requestAnimationFrame(drawScene);
      
      // After the moon rotation phase, start the counter overlay animation
      setTimeout(() => {
        animateCounter(fullMoonsLived, counterAnimationDuration);
      }, moonRotationDuration);
    });
    
    /*********** SHARE BUTTON FUNCTIONALITY ***********/
    shareButton.addEventListener('click', function() {
      const shareData = {
        title: "My Moon Life Journey",
        text: "I've lived " + fullMoonsLived + " full moons so far!",
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData).catch(err => console.error("Error sharing:", err));
      } else {
        copyToClipboard(window.location.href);
        alert("Link copied to clipboard!");
      }
    });
    
    function copyToClipboard(text) {
      const tempInput = document.createElement("input");
      tempInput.style.position = "absolute";
      tempInput.style.left = "-1000px";
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand("copy");
      document.body.removeChild(tempInput);
    }
  </script>
</body>
</html>
