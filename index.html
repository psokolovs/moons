<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moon Life Journey</title>
  <style>
    /* Reset and full-screen basics */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    /* Input Screen */
    #inputScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      text-align: center;
    }
    #inputScreen h1 {
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    #birthForm {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    #birthForm input[type="date"] {
      width: 320px; /* wide enough for a 4-digit year */
      max-width: 90%;
      font-size: 1.2em;
      padding: 10px;
      border: 2px solid #fff;
      background: #111;
      color: #fff;
    }
    #birthForm button {
      font-size: 1.2em;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    #birthForm button:hover {
      background: #ccc;
    }
    /* Full-screen Canvas */
    #sceneCanvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 5;
    }
    /* Overlay for counter, buttons, and milestone info */
    #overlay {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      z-index: 20;
    }
    #counterOverlay {
      font-size: 2em;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 1s;
    }
    #milestoneOverlay {
      font-size: 1.5em;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 1s;
    }
    /* Play (Fast Forward) and Share buttons */
    #playButton, #shareButton {
      font-size: 1.2em;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      display: none;
      margin: 5px;
    }
    #playButton:hover, #shareButton:hover {
      background: #ccc;
    }
  </style>
</head>
<body>
  <!-- Input Screen -->
  <div id="inputScreen">
    <h1>Moon Life Journey</h1>
    <form id="birthForm">
      <input type="date" id="birthdate" required />
      <button type="submit">Calculate My Moons</button>
    </form>
  </div>

  <!-- Full-screen Canvas -->
  <canvas id="sceneCanvas"></canvas>

  <!-- Overlay for counter, fast-forward play button, milestone info, and share button -->
  <div id="overlay">
    <div id="counterOverlay"></div>
    <button id="playButton">Fast Forward</button>
    <div id="milestoneOverlay"></div>
    <button id="shareButton">Share Your Journey</button>
  </div>

  <script>
    /************* GLOBAL VARIABLES & SETUP *************/
    const lunarMonth = 29.53059; // days per lunar cycle
    let fullMoonsLived = 0;
    let phase = "idle"; // possible phases: "slow", "waiting", "fast", "done"
    let slowStartTime = null;
    let fastStartTime = null;
    const slowDuration = 10000; // 10 seconds for the slow spin phase
    const fastDuration = 4000;  // 4 seconds for the fast-forward phase
    let currentRotationAngle = 0;
    
    // Get DOM elements
    const inputScreen = document.getElementById('inputScreen');
    const birthForm = document.getElementById('birthForm');
    const birthdateInput = document.getElementById('birthdate');
    const sceneCanvas = document.getElementById('sceneCanvas');
    const ctx = sceneCanvas.getContext('2d');
    const counterOverlay = document.getElementById('counterOverlay');
    const playButton = document.getElementById('playButton');
    const milestoneOverlay = document.getElementById('milestoneOverlay');
    const shareButton = document.getElementById('shareButton');
    
    // Set max date for birthdate input to today
    birthdateInput.max = new Date().toISOString().split("T")[0];
    
    // Setup canvas dimensions and update moon parameters on resize
    function resizeCanvas() {
      sceneCanvas.width = window.innerWidth;
      sceneCanvas.height = window.innerHeight;
      // Update moon object: center and large (fills most of the view)
      moon.x = sceneCanvas.width / 2;
      moon.y = sceneCanvas.height / 2;
      moon.radius = Math.min(sceneCanvas.width, sceneCanvas.height) * 0.45;
    }
    window.addEventListener('resize', resizeCanvas);
    
    /************* STARFIELD (Procedural Background) *************/
    const stars = [];
    const numStars = 300;
    function initStars() {
      stars.length = 0;
      for (let i = 0; i < numStars; i++) {
        stars.push({
          x: Math.random() * sceneCanvas.width,
          y: Math.random() * sceneCanvas.height,
          radius: Math.random() * 1.5,
          alpha: Math.random() * 0.8 + 0.2
        });
      }
    }
    function drawStars() {
      for (let star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, 2 * Math.PI);
        ctx.fillStyle = `rgba(255,255,255,${star.alpha})`;
        ctx.fill();
      }
    }
    
    /************* MOON OBJECT & DRAWING *************/
    const moon = { x: 0, y: 0, radius: 0 };
    // Draw the moon using a radial gradient and fixed crater positions for consistency
    function drawMoon(angle) {
      ctx.save();
      ctx.translate(moon.x, moon.y);
      ctx.rotate(angle);
      const grad = ctx.createRadialGradient(
        -moon.radius * 0.3, -moon.radius * 0.3, moon.radius * 0.1,
         0, 0, moon.radius
      );
      grad.addColorStop(0, '#e0e0e0');
      grad.addColorStop(1, '#777777');
      ctx.beginPath();
      ctx.arc(0, 0, moon.radius, 0, 2 * Math.PI);
      ctx.fillStyle = grad;
      ctx.fill();
      ctx.fillStyle = 'rgba(0,0,0,0.15)';
      const craterPositions = [
        { x: -moon.radius * 0.4, y: -moon.radius * 0.2, r: moon.radius * 0.08 },
        { x: moon.radius * 0.3, y: -moon.radius * 0.3, r: moon.radius * 0.06 },
        { x: -moon.radius * 0.1, y: moon.radius * 0.4, r: moon.radius * 0.07 },
        { x: moon.radius * 0.2, y: moon.radius * 0.2, r: moon.radius * 0.05 },
        { x: -moon.radius * 0.3, y: moon.radius * 0.3, r: moon.radius * 0.06 }
      ];
      craterPositions.forEach(pos => {
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, pos.r, 0, 2 * Math.PI);
        ctx.fill();
      });
      ctx.restore();
    }
    
    /************* ANIMATION LOOP *************/
    // This loop handles both the slow (human speed) phase and the fast-forward phase.
    function animate(timestamp) {
      ctx.clearRect(0, 0, sceneCanvas.width, sceneCanvas.height);
      drawStars();
      
      if (phase === "slow") {
        if (!slowStartTime) slowStartTime = timestamp;
        let elapsed = timestamp - slowStartTime;
        if (elapsed < slowDuration) {
          // Rotate slowly: one full revolution in 10 seconds.
          currentRotationAngle = (elapsed / slowDuration) * 2 * Math.PI;
          updateCounter(1);
        } else {
          // End slow phase: set rotation to 0 (starting position) and update counter.
          currentRotationAngle = 0;
          phase = "waiting";
          updateCounter(1);
          // Show the fast-forward (play) button.
          playButton.style.display = "inline-block";
        }
      } else if (phase === "fast") {
        let elapsed = timestamp - fastStartTime;
        if (elapsed < fastDuration) {
          // Use an ease-in-out easing for a smooth fast-forward.
          let t = elapsed / fastDuration;
          t = t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
          // The additional revolutions required: total full moons minus the one from slow phase.
          let additionalRevs = t * (fullMoonsLived - 1);
          // For visual effect, show the current revolution's fractional rotation.
          currentRotationAngle = (additionalRevs % 1) * 2 * Math.PI;
          updateCounter(1 + Math.floor(additionalRevs));
        } else {
          // Fast-forward phase complete.
          currentRotationAngle = 0;
          updateCounter(fullMoonsLived);
          phase = "done";
          // Fade in milestone overlay.
          milestoneOverlay.style.opacity = 1;
          let milestone = (fullMoonsLived < 10) ? 10 : Math.ceil(fullMoonsLived / 100) * 100;
          let remaining = milestone - fullMoonsLived;
          milestoneOverlay.innerHTML = `Your next milestone is <strong>${milestone}</strong> full moons.<br>
                                        You have <strong>${remaining}</strong> more to go.`;
          shareButton.style.display = "inline-block";
        }
      }
      
      drawMoon(currentRotationAngle);
      requestAnimationFrame(animate);
    }
    
    // Update the counter overlay text.
    function updateCounter(count) {
      counterOverlay.style.opacity = 1;
      counterOverlay.innerText = count + " FULL MOON" + (count === 1 ? " LIVED" : "S LIVED");
    }
    
    /************* FORM HANDLING & INIT *************/
    birthForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const birthDateStr = birthdateInput.value;
      if (!birthDateStr) return;
      const birthDate = new Date(birthDateStr);
      const currentDate = new Date();
      const daysLived = (currentDate - birthDate) / (1000 * 60 * 60 * 24);
      fullMoonsLived = Math.floor(daysLived / lunarMonth);
      if (fullMoonsLived < 1) fullMoonsLived = 1; // Ensure at least one full moon.
      // Hide input screen; show canvas and overlay.
      inputScreen.style.display = "none";
      sceneCanvas.style.display = "block";
      initStars();
      resizeCanvas();
      phase = "slow";
      slowStartTime = null;
      requestAnimationFrame(animate);
    });
    
    /************* FAST-FORWARD (Play Button) *************/
    playButton.addEventListener('click', function() {
      if (phase === "waiting") {
        phase = "fast";
        fastStartTime = null;
        playButton.style.display = "none";
      }
    });
    
    /************* SHARE BUTTON FUNCTIONALITY *************/
    shareButton.addEventListener('click', function() {
      const shareData = {
        title: "My Moon Life Journey",
        text: "I've lived " + fullMoonsLived + " full moons so far!",
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData).catch(err => console.error("Error sharing:", err));
      } else {
        copyToClipboard(window.location.href);
        alert("Link copied to clipboard!");
      }
    });
    function copyToClipboard(text) {
      const tempInput = document.createElement("input");
      tempInput.style.position = "absolute";
      tempInput.style.left = "-1000px";
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand("copy");
      document.body.removeChild(tempInput);
    }
  </script>
</body>
</html>
